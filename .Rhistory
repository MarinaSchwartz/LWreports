#adding a column using if/else for trophic state
Lake_2 = Lake_2 %>% mutate(trophic_state = ifelse(
gmean(CHL) < 3, "Oligotrophic", ifelse(
gmean(CHL) >= 3 & gmean(CHL) < 7, "Mesotrophic", ifelse(
gmean(CHL) >= 7 & gmean(CHL) < 40, "Eutrophic", "Hypereutrophic"))))
if(Lake_1$`water type`[1] == "Lake") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Lake.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Lake",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "Estuary") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Estuary.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Estuary",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "River/Stream") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code RiverStream.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/RiverStream",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
#counter
print(Lake_2$Lake_County[1])
print(paste(n_count, "/", N_count))
n_count <- n_count+1
}
# Project Notes ----
#
### WD and Packages ----
#setwd("/Documents/GitHub/LWreports/.RData")
library(tidyverse)
library(gt)
library(SciViews)
library(broom)
library(glue)
library(ggtext)
library(readxl)
library(tinytex)
#tinytex::install_tinytex()
#tinytex::tlmgr_update()
### Data Import ----
data_1 = read_xlsx("Data/Lakewatch Base File RMD.xlsx")
data_2 = read.csv("Data/All_Data_RMD.csv")
### Functions ----
gmean <- function(x){
xc <- x[!is.na(x)]
xg <- exp(mean(log(xc[xc>0])))
xg <- round(xg)
return(xg)
}
### Data Prep ----
data_1 <- data_1 %>%
mutate(Lake_County = paste(Lake, County)) %>%
filter(Study == "LW") %>%
filter(County == "Jackson") %>%
filter(`water type` == "Lake" | `water type` == "River/Stream" | `water type` == "Estuary")
head(data_1)
data_2 = data_2 %>%
mutate(Station = as.character(Station)) %>%
mutate(Lake_County = paste(Lake, County))
head(data_2)
#add na.ignore here to avoid loop error when no data exists for a lake
data_all <- data_1 %>% full_join(data_2, by = c("Lake_County", "Station"))
head(data_all)
### for loop with counter ----
#Run ONE of these two lines
#Lakes = unique(data_1$Lake_County)
Lakes = c("Silver Jackson")
#"Westchester Pinellas",
#"Winston Pinellas")
print(Lakes)
n_count = 1
N_count = length(Lakes)
for(l in Lakes){
#subsets data for lake of interest
Lake_1 <- data_1 %>%
filter(Lake_County == l)
Lake_2 <- data_2 %>%
filter(Lake_County == l)
file_name = paste(Lake_2[1], ".pdf")
#adding a column using if/else for lake classification
##this code currently has no fallback for if the data is missing.
Lake_2 = Lake_2 %>% mutate(lake_class = ifelse(
gmean(`Color`) > 40, "Colored", ifelse(
gmean(`Color`) <= 40 & gmean(`Cond_uS`) <= 20, "Clear Soft Water","Clear Hard Water")))
#adding a column using if/else for trophic state
Lake_2 = Lake_2 %>% mutate(trophic_state = ifelse(
gmean(CHL) < 3, "Oligotrophic", ifelse(
gmean(CHL) >= 3 & gmean(CHL) < 7, "Mesotrophic", ifelse(
gmean(CHL) >= 7 & gmean(CHL) < 40, "Eutrophic", "Hypereutrophic"))))
if(Lake_1$`water type`[1] == "Lake") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Lake.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Lake",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "Estuary") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Estuary.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Estuary",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "River/Stream") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code RiverStream.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/RiverStream",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
#counter
print(Lake_2$Lake_County[1])
print(paste(n_count, "/", N_count))
n_count <- n_count+1
}
# Project Notes ----
#
### WD and Packages ----
#setwd("/Documents/GitHub/LWreports/.RData")
library(tidyverse)
library(gt)
library(SciViews)
library(broom)
library(glue)
library(ggtext)
library(readxl)
library(tinytex)
#tinytex::install_tinytex()
#tinytex::tlmgr_update()
### Data Import ----
data_1 = read_xlsx("Data/Lakewatch Base File RMD.xlsx")
data_2 = read.csv("Data/All_Data_RMD.csv")
### Functions ----
gmean <- function(x){
xc <- x[!is.na(x)]
xg <- exp(mean(log(xc[xc>0])))
xg <- round(xg)
return(xg)
}
### Data Prep ----
data_1 <- data_1 %>%
mutate(Lake_County = paste(Lake, County)) %>%
filter(Study == "LW") %>%
filter(County == "Flagler") %>%
filter(`water type` == "Lake" | `water type` == "River/Stream" | `water type` == "Estuary")
head(data_1)
data_2 = data_2 %>%
mutate(Station = as.character(Station)) %>%
mutate(Lake_County = paste(Lake, County))
head(data_2)
#add na.ignore here to avoid loop error when no data exists for a lake
data_all <- data_1 %>% full_join(data_2, by = c("Lake_County", "Station"))
head(data_all)
### for loop with counter ----
#Run ONE of these two lines
#Lakes = unique(data_1$Lake_County)
Lakes = c("Grand Haven 1 Flagler",
"Grand Haven 12 Flagler",
"Grand Haven 13 Flagler",
"Grand Haven 18A Flagler",
"Grand Haven 28 Flagler",
"Grand Haven 4 Flagler",
"Grand Haven 5 Flagler",
"Grand Haven W6 Flagler")
print(Lakes)
n_count = 1
N_count = length(Lakes)
for(l in Lakes){
#subsets data for lake of interest
Lake_1 <- data_1 %>%
filter(Lake_County == l)
Lake_2 <- data_2 %>%
filter(Lake_County == l)
file_name = paste(Lake_2[1], ".pdf")
#adding a column using if/else for lake classification
##this code currently has no fallback for if the data is missing.
Lake_2 = Lake_2 %>% mutate(lake_class = ifelse(
gmean(`Color`) > 40, "Colored", ifelse(
gmean(`Color`) <= 40 & gmean(`Cond_uS`) <= 20, "Clear Soft Water","Clear Hard Water")))
#adding a column using if/else for trophic state
Lake_2 = Lake_2 %>% mutate(trophic_state = ifelse(
gmean(CHL) < 3, "Oligotrophic", ifelse(
gmean(CHL) >= 3 & gmean(CHL) < 7, "Mesotrophic", ifelse(
gmean(CHL) >= 7 & gmean(CHL) < 40, "Eutrophic", "Hypereutrophic"))))
if(Lake_1$`water type`[1] == "Lake") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Lake.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Lake",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "Estuary") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Estuary.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Estuary",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "River/Stream") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code RiverStream.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/RiverStream",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
#counter
print(Lake_2$Lake_County[1])
print(paste(n_count, "/", N_count))
n_count <- n_count+1
}
### Graphs ----
if(tp_n$n >= 5){
plot_title = glue("Total Phosphorus (µg/L) by Year for {Lake_2$Lake[1]} in {Lake_2$County[1]} County")
Lake_2_bymo_TP = Lake_2 %>%
group_by(Year, na.rm=TRUE)%>%
dplyr::summarise(gmean.TP = gmean(TP), na.rm=TRUE, SD.TP = sd(TP, na.rm=TRUE))
Lake_2_bymo_TP$ymax = Lake_2_bymo_TP$gmean.TP+Lake_2_bymo_TP$SD.TP
Lake_2_bymo_TP$ymin = Lake_2_bymo_TP$gmean.TP-Lake_2_bymo_TP$SD.TP
total_p_lm = lm(gmean.TP ~ Year, data = Lake_2_bymo_TP)
maxlim = max(Lake_2_bymo_TP$ymax, na.rm = TRUE)
minlim = min(Lake_2_bymo_TP$ymin, na.rm = TRUE)
total_p_table = glance(total_p_lm)
trend = if_else(
total_p_table$p.value >= 0.05,
true = "No trend",
false = if_else(
total_p_lm[["coefficients"]][["Year"]] > 0 ,
true = "Increasing",
false = "Decreasing"))
#label = (glue("p = {signif(total_p_table$p.value, digits = 2)}, R<sup>2</sup> = {signif(total_p_table$r.squared, digits = 2)}, {trend} "))
label2 = (glue("p = {signif(total_p_table$p.value, digits = 2)}, R^2 = {signif(total_p_table$r.squared, digits = 2)}, {trend} "))
total_p_graph <- ggplot(data = Lake_2_bymo_TP, aes(x = Year, y = gmean.TP)) +
geom_point() +
geom_smooth(
method = "lm",
se = TRUE,
color = "darkcyan",
alpha=0.15,
linetype = paste(if_else(total_p_table$p.value <= 0.05,true = "solid", false = "dashed" ))) +
labs(title = plot_title, x = "Year", y = "Total Phosphorus (µg/L)",caption=paste0(label2))+
scale_x_continuous(breaks = seq(min(Lake_2_bymo_TP$Year),
max(Lake_2_bymo_TP$Year), by = 2),
labels=scales::number_format(accuracy=1))+
theme_bw() +
theme(plot.title = element_text(hjust = 0.5)) +
theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1))+
geom_errorbar(aes(ymin=gmean.TP-SD.TP, ymax=gmean.TP+SD.TP), width=.2, position=position_dodge(.9)) +
ylim(minlim, maxlim)
#we decided to save as a png file due to issues with knitr rendering the graph when knitting. it seems to understand how to knit a png file more consistently.
ggsave("~/Documents/GitHub/LWreports/Output/Lake/output_graphs/total_p_graph.png", width = 6, height = 4, units = "in", dpi = 300)
}
if(tp_n$n >= 5){
knitr::include_graphics("~/Documents/GitHub/LWreports/Output/Lake/output_graphs/total_p_graph.png")
}
# Project Notes ----
#
### WD and Packages ----
#setwd("/Documents/GitHub/LWreports/.RData")
library(tidyverse)
library(gt)
library(SciViews)
library(broom)
library(glue)
library(ggtext)
library(readxl)
library(tinytex)
#tinytex::install_tinytex()
#tinytex::tlmgr_update()
### Data Import ----
data_1 = read_xlsx("Data/Lakewatch Base File RMD.xlsx")
data_2 = read.csv("Data/All_Data_RMD.csv")
### Functions ----
gmean <- function(x){
xc <- x[!is.na(x)]
xg <- exp(mean(log(xc[xc>0])))
xg <- round(xg)
return(xg)
}
### Data Prep ----
data_1 <- data_1 %>%
mutate(Lake_County = paste(Lake, County)) %>%
filter(Study == "LW") %>%
filter(County == "Volusia") %>%
filter(`water type` == "Lake" | `water type` == "River/Stream" | `water type` == "Estuary")
head(data_1)
data_2 = data_2 %>%
mutate(Station = as.character(Station)) %>%
mutate(Lake_County = paste(Lake, County))
head(data_2)
#add na.ignore here to avoid loop error when no data exists for a lake
data_all <- data_1 %>% full_join(data_2, by = c("Lake_County", "Station"))
head(data_all)
### for loop with counter ----
#Run ONE of these two lines
#Lakes = unique(data_1$Lake_County)
Lakes = c("North Talmadge Volusia")
#  ,
#  "Grand Haven 12 Flagler",
#  "Grand Haven 13 Flagler",
#  "Grand Haven 18A Flagler",
#  "Grand Haven 28 Flagler",
#  "Grand Haven 4 Flagler",
#  "Grand Haven 5 Flagler",
# "Grand Haven W6 Flagler")
print(Lakes)
n_count = 1
N_count = length(Lakes)
for(l in Lakes){
#subsets data for lake of interest
Lake_1 <- data_1 %>%
filter(Lake_County == l)
Lake_2 <- data_2 %>%
filter(Lake_County == l)
file_name = paste(Lake_2[1], ".pdf")
#adding a column using if/else for lake classification
##this code currently has no fallback for if the data is missing.
Lake_2 = Lake_2 %>% mutate(lake_class = ifelse(
gmean(`Color`) > 40, "Colored", ifelse(
gmean(`Color`) <= 40 & gmean(`Cond_uS`) <= 20, "Clear Soft Water","Clear Hard Water")))
#adding a column using if/else for trophic state
Lake_2 = Lake_2 %>% mutate(trophic_state = ifelse(
gmean(CHL) < 3, "Oligotrophic", ifelse(
gmean(CHL) >= 3 & gmean(CHL) < 7, "Mesotrophic", ifelse(
gmean(CHL) >= 7 & gmean(CHL) < 40, "Eutrophic", "Hypereutrophic"))))
if(Lake_1$`water type`[1] == "Lake") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Lake.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Lake",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "Estuary") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Estuary.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Estuary",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "River/Stream") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code RiverStream.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/RiverStream",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
#counter
print(Lake_2$Lake_County[1])
print(paste(n_count, "/", N_count))
n_count <- n_count+1
}
# Project Notes ----
#
### WD and Packages ----
#setwd("/Documents/GitHub/LWreports/.RData")
library(tidyverse)
library(gt)
library(SciViews)
library(broom)
library(glue)
library(ggtext)
library(readxl)
library(tinytex)
#tinytex::install_tinytex()
#tinytex::tlmgr_update()
### Data Import ----
data_1 = read_xlsx("Data/Lakewatch Base File RMD.xlsx")
data_2 = read.csv("Data/All_Data_RMD.csv")
### Functions ----
gmean <- function(x){
xc <- x[!is.na(x)]
xg <- exp(mean(log(xc[xc>0])))
xg <- round(xg)
return(xg)
}
### Data Prep ----
data_1 <- data_1 %>%
mutate(Lake_County = paste(Lake, County)) %>%
filter(Study == "LW") %>%
filter(County == "Volusia") %>%
filter(`water type` == "Lake" | `water type` == "River/Stream" | `water type` == "Estuary")
head(data_1)
data_2 = data_2 %>%
mutate(Station = as.character(Station)) %>%
mutate(Lake_County = paste(Lake, County))
head(data_2)
#add na.ignore here to avoid loop error when no data exists for a lake
data_all <- data_1 %>% full_join(data_2, by = c("Lake_County", "Station"))
head(data_all)
### for loop with counter ----
#Run ONE of these two lines
#Lakes = unique(data_1$Lake_County)
Lakes = c("North Talmadge Volusia")
#  ,
#  "Grand Haven 12 Flagler",
#  "Grand Haven 13 Flagler",
#  "Grand Haven 18A Flagler",
#  "Grand Haven 28 Flagler",
#  "Grand Haven 4 Flagler",
#  "Grand Haven 5 Flagler",
# "Grand Haven W6 Flagler")
print(Lakes)
n_count = 1
N_count = length(Lakes)
for(l in Lakes){
#subsets data for lake of interest
Lake_1 <- data_1 %>%
filter(Lake_County == l)
Lake_2 <- data_2 %>%
filter(Lake_County == l)
file_name = paste(Lake_2[1], ".pdf")
#adding a column using if/else for lake classification
##this code currently has no fallback for if the data is missing.
Lake_2 = Lake_2 %>% mutate(lake_class = ifelse(
gmean(`Color`) > 40, "Colored", ifelse(
gmean(`Color`) <= 40 & gmean(`Cond_uS`) <= 20, "Clear Soft Water","Clear Hard Water")))
#adding a column using if/else for trophic state
Lake_2 = Lake_2 %>% mutate(trophic_state = ifelse(
gmean(CHL) < 3, "Oligotrophic", ifelse(
gmean(CHL) >= 3 & gmean(CHL) < 7, "Mesotrophic", ifelse(
gmean(CHL) >= 7 & gmean(CHL) < 40, "Eutrophic", "Hypereutrophic"))))
if(Lake_1$`water type`[1] == "Lake") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Lake.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Lake",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "Estuary") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Estuary.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Estuary",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "River/Stream") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code RiverStream.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/RiverStream",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
#counter
print(Lake_2$Lake_County[1])
print(paste(n_count, "/", N_count))
n_count <- n_count+1
}
# Project Notes ----
#
### WD and Packages ----
#setwd("/Documents/GitHub/LWreports/.RData")
library(tidyverse)
library(gt)
library(SciViews)
library(broom)
library(glue)
library(ggtext)
library(readxl)
library(tinytex)
#tinytex::install_tinytex()
#tinytex::tlmgr_update()
### Data Import ----
data_1 = read_xlsx("Data/Lakewatch Base File RMD.xlsx")
data_2 = read.csv("Data/All_Data_RMD.csv")
### Functions ----
gmean <- function(x){
xc <- x[!is.na(x)]
xg <- exp(mean(log(xc[xc>0])))
xg <- round(xg)
return(xg)
}
### Data Prep ----
data_1 <- data_1 %>%
mutate(Lake_County = paste(Lake, County)) %>%
filter(Study == "LW") %>%
filter(County == "Charlotte") %>%
filter(`water type` == "Lake" | `water type` == "River/Stream" | `water type` == "Estuary")
head(data_1)
data_2 = data_2 %>%
mutate(Station = as.character(Station)) %>%
mutate(Lake_County = paste(Lake, County))
head(data_2)
#add na.ignore here to avoid loop error when no data exists for a lake
data_all <- data_1 %>% full_join(data_2, by = c("Lake_County", "Station"))
head(data_all)
### for loop with counter ----
#Run ONE of these two lines
Lakes = unique(data_1$Lake_County)
#Lakes = c("North Talmadge Volusia")
#  ,
#  "Grand Haven 12 Flagler",
#  "Grand Haven 13 Flagler",
#  "Grand Haven 18A Flagler",
#  "Grand Haven 28 Flagler",
#  "Grand Haven 4 Flagler",
#  "Grand Haven 5 Flagler",
# "Grand Haven W6 Flagler")
print(Lakes)
n_count = 1
N_count = length(Lakes)
for(l in Lakes){
#subsets data for lake of interest
Lake_1 <- data_1 %>%
filter(Lake_County == l)
Lake_2 <- data_2 %>%
filter(Lake_County == l)
file_name = paste(Lake_2[1], ".pdf")
#adding a column using if/else for lake classification
##this code currently has no fallback for if the data is missing.
Lake_2 = Lake_2 %>% mutate(lake_class = ifelse(
gmean(`Color`) > 40, "Colored", ifelse(
gmean(`Color`) <= 40 & gmean(`Cond_uS`) <= 20, "Clear Soft Water","Clear Hard Water")))
#adding a column using if/else for trophic state
Lake_2 = Lake_2 %>% mutate(trophic_state = ifelse(
gmean(CHL) < 3, "Oligotrophic", ifelse(
gmean(CHL) >= 3 & gmean(CHL) < 7, "Mesotrophic", ifelse(
gmean(CHL) >= 7 & gmean(CHL) < 40, "Eutrophic", "Hypereutrophic"))))
if(Lake_1$`water type`[1] == "Lake") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Lake.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Lake",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "Estuary") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code Estuary.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/Estuary",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
if(Lake_1$`water type`[1] == "River/Stream") {
rmarkdown::render(input = "Scripts/LWReport Markdown Code RiverStream.Rmd", output_format = "pdf_document",         # 2. Establish the format
output_file = paste0(l ,"_report.pdf"), # 3. Define the output file name
output_dir = "Output/RiverStream",                       # 4. Define an output folder/directory
params = list(Lakes = l))  }
#counter
print(Lake_2$Lake_County[1])
print(paste(n_count, "/", N_count))
n_count <- n_count+1
}
